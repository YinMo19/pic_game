<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速反应 Pic Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        #start-screen img {
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }

        #start-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #question-image img {
            width: 200px;
            height: 200px;
            margin: 10px;
            cursor: pointer; /* 添加鼠标指针样式以提示可点击 */
        }

        #options {
            display: none; /* 默认隐藏选项 */
            display: grid;
            grid-template-columns: repeat(2, 200px);
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        #options img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer; /* 添加鼠标指针样式以提示可点击 */
        }

        .result-message {
            color: green;
            margin-top: 10px;
        }

        .error-message {
            color: red;
            margin-top: 10px;
        }

        .time-used {
            color: blue;
            margin-top: 10px;
        }

        .correct-all {
            color: purple;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>记住这张图！</h1>
    <h3>接下来每页将会出现上一次题图，你需要点击上一次的题图...
        速度如果慢了可就没了哦..
    </h3>
    <div id="start-screen">
        <img id="start-image" alt="Start Image">
        <button id="start-button">开始</button>
    </div>
    <div id="question-image"></div>
    <div id="options"></div>
    <div id="result-message" class="result-message"></div>
    <div id="error-message" class="error-message"></div>
    <div id="time-used" class="time-used"></div> <!-- 添加时间显示元素 -->
    <div id="correct-all" class="correct-all"></div> <!-- 添加正确答案显示元素 -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchInitialQuestion();
        });

        document.getElementById('start-button').addEventListener('click', startGame);

        let timeUsed = 0;
        let correctAll = false;

        async function fetchInitialQuestion() {
            const response = await fetch('/question');
            const data = await response.json();
            document.getElementById('start-image').src = data.question_image_url;
        }

        async function startGame() {
            document.getElementById('start-screen').style.display = 'none'; // 隐藏开始屏幕
            document.getElementById('options').style.display = 'grid'; // 显示选项
            document.getElementById('time-used').textContent = ''; // 显示使用时间
            document.getElementById('correct-all').textContent = ''; // 显示正确答案信息
            fetchQuestion(true);
        }

        async function fetchQuestion(begin_flag=false) {
            const response = await fetch('/question?begin_flag=' + begin_flag);
            const data = await response.json();
            document.getElementById('question-image').style.display = 'block';
            document.getElementById('question-image').innerHTML = `<img src="${data.question_image_url}" alt="Question Image">`;
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            data.options.forEach((option, index) => {
                const img = document.createElement('img');
                img.src = option;
                img.alt = `Option ${index}`;
                img.addEventListener('click', () => sendAnswer(index));
                optionsDiv.appendChild(img);
            });
        }

        async function sendAnswer(answerIndex) {
            try {
                const response = await fetch('/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ answer: answerIndex })
                });

                if (response.ok) {
                    const result = await response.json();
                    const resultMessageDiv = document.getElementById('result-message');
                    const errorMessageDiv = document.getElementById('error-message');
                    errorMessageDiv.textContent = ''; // 清除之前的错误消息

                    if (result.success) {
                        resultMessageDiv.textContent = 'Correct!';
                        fetchQuestion(); // 重新获取问题
                    } else {
                        resultMessageDiv.textContent = 'Incorrect!';
                        timeUsed = result.time_used; // 存储使用时间
                        correctAll = result.correct_all; // 存储正确答案信息
                        restartGame(); // 重启游戏
                    }
                } else {
                    const errorMessageDiv = document.getElementById('error-message');
                    errorMessageDiv.textContent = 'Failed to send answer';
                }
            } catch (error) {
                const errorMessageDiv = document.getElementById('error-message');
                errorMessageDiv.textContent = `Error sending answer: ${error.message}`;
            }
        }

        function restartGame() {
            document.getElementById('start-screen').style.display = 'flex'; // 显示开始屏幕
            document.getElementById('options').style.display = 'none'; // 隐藏选项
            document.getElementById('question-image').style.display = 'none'; // 隐藏选项
            document.getElementById('result-message').textContent = ''; // 清除结果消息
            document.getElementById('error-message').textContent = ''; // 清除错误消息
            document.getElementById('time-used').textContent = `Time used: ${timeUsed/1000} seconds`; // 显示使用时间
            document.getElementById('correct-all').textContent = `Correct answers: ${correctAll}`; // 显示正确答案信息
            fetchInitialQuestion(); // 获取初始问题
        }
    </script>
</body>
</html>